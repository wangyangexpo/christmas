function getQueryString(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(n);return null!=t?decodeURIComponent(t[2]):null}function countDown(e){var n=$(".getcode"),t=setInterval(function(){e?n.text(e-1+"秒"):(n.text("获取验证码"),clearInterval(t)),e--},1e3)}FastClick.attach(document.body);var giftlist={0:{name:"圣诞精灵证书",el:['<img src="../images/zhengshu/zhengshu_','.png" alt="" class="zhengshu">'],pre:"1张"},104:{name:"葡萄积木警车",el:'<img src="../images/opened/jingche.png" alt="" class="jingche">',pre:"1辆"},101:{name:"摩拜单车月卡",el:'<img src="../images/opened/yueka.png" alt="" class="yueka">',pre:"1张"},102:{name:"摩拜单车年卡",el:'<img src="../images/opened/nianka.png" alt="" class="nianka">',pre:"1张"}};$(function(){var e,n=$("#mgmask"),t=getQueryString("nickname")||"",i=getQueryString("giftid")||0,a=getQueryString("isshare")||0,o=getData("mb_code")||"";if($(".wx-name").text(t+"，"),i>=0&&i<=20?(e=giftlist[0]).el=e.el[0]+i+e.el[1]:(e=giftlist[i])?(0==a&&$(".receive").show(),$("#lucky").addClass("find")):(e=giftlist[0]).el=e.el[0]+"0"+e.el[1],$(".gift-img").html(e.el),$(".gift-name").html(e.name),is_weixin()){var c=config.shareorigin+"html/mygift_opened.html?giftid="+i+"&nickname="+encodeURIComponent(t)+"&isshare=1";wxShare(c,2,e.pre+e.name)}n.on("click",".icon-close",function(){n.find(".bg-rotate,.gift-img>img").addClass("disappear"),setTimeout(function(){n.hide()},1e3)});var l=$(".getcode"),g=$(".phone"),r=$(".code"),s=$(".commit"),m=/^1[0-9]{10}$/;l.on("click",function(){var e=l.text(),n=$.trim(g.val());11==n.length&&m.test(n)?"获取验证码"==e&&(countDown(60),giftGetCode(n)):alert("请输入正确的手机号")}),s.on("click",function(){var e=$.trim(g.val()),n=$.trim(r.val());console.log(e,n),e?n?giftCheckCode(e,n,function(n){0==n.error_code&&(location.href="./mygift_receive.html?giftid="+i+"&mb_code="+o+"&phone="+e+"&nickname="+encodeURIComponent(t))}):alert("请输入验证码！"):alert("请输入手机号！")})});