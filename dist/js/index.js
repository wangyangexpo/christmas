function loading(){var a=0,n=$("#loading_pic");return setInterval(function(){a%=6,n.css("backgroundPosition",40*-a+"vw"),a++},100)}function preloadImages(a,n,t){for(var s=a.length,e=0,o=0;o<s;o++){var i=document.createElement("img");i.src=a[o],i.onload=function(){this.onload=null,e++,$("#load_percent").text((e/t*100).toFixed(2)),e>=s&&n()}}}function loadHandler(a){audioDone++,$("#load_percent").text(((c_image_length+audioDone)/res_total_length*100).toFixed(2)),audioDone>=c_audio_length&&(clearInterval(loadingani),$("#loading").remove(),$("#stage").show(),$("#go").on("touchstart",function(){$("#go").off("touchstart"),$(".before").addClass("disappear");createjs.Sound.play("bgm");santaClausAnimate1()}))}function preloadAudio(a){createjs.Sound.on("fileload",loadHandler);var n=a.length;if(n)for(var t=0;t<n;t++)createjs.Sound.registerSound(a[t].src,a[t].id);else clearInterval(loadingani),$("#loading").remove(),$("#stage").show(),$(document).on("touchstart",function(){$(document).off("touchstart");createjs.Sound.play("bgm");santaClausAnimate1()})}function santaClausAnimate1(){(belling=createjs.Sound.play("bell")).loop=1/0,$santaClaus.addClass("santa-claus-1"),animate("#santa-claus","left",100,-15,.5,function(){$santaClaus.removeClass("santa-claus-1"),santaClausAnimate2()})}function santaClausAnimate2(){$santaClaus.addClass("santa-claus-2"),animate("#santa-claus","left",-20,110,.6,function(){$santaClaus.removeClass("santa-claus-2"),furtherStageAnimate()})}function santaClausAnimate3(){$santaClaus.addClass("santa-claus-3"),animate("#santa-claus","left",100,-75,1.2,function(){$santaClaus.removeClass("santa-claus-3"),belling.stop(),santaClausAnimate4()})}function santaClausAnimate4(){$santaClaus.addClass("santa-claus-4"),animate("#santa-claus","left",-120,20,2.5,function(){createjs.Sound.play("laugh"),setTimeout(function(){$santaClaus.removeClass("santa-claus-4"),$santaClaus.addClass("santa-claus-5"),giftAnimate()},1e3)})}function giftAnimate(){var a=$("#gift");a.show();createjs.Sound.play("gift");var n=13,t=14.9,s=29,e=150,o=Math.abs(n-32),i=Math.abs(.8),l=(34-s)*i/o,u=(110-e)*i/o,g=(36.6-t)*i/o,c=function(){n+=.8,s+=l,e+=u,t+=g,a.css({width:n+"vw",height:t+"vw",top:e+"vw",left:s+"vw"}),Math.abs(32-n)<Math.abs(.8)?(a.css({width:"32vw",height:"36.6vw",top:"110vw",left:"34vw"}),console.log("gift end"),giftDroping()):requestAnimationFrame(c)};requestAnimationFrame(c)}function giftDroping(){var a=$("#stage").css("willChange","top"),n=$("#gift").css("willChange","top,left,width"),t=0,s=110,e=34,o=32,i=36.6,l=Math.abs(t- -128),u=Math.abs(-3),g=(290-s)*u/l,c=(48-o)*u/l,m=(26-e)*u/l,r=(54.9-i)*u/l,d=function(){t+=-3,s+=g,o+=c,e+=m,i+=r,n.css({top:s+"vw",width:o+"vw",height:i+"vw",left:e+"vw"}),a.css({top:t+"vw"}),Math.abs(-128-t)<Math.abs(-3)?(n.css({top:"290vw",width:"48vw",height:"54.9vw",left:"26vw",willChange:"auto"}),a.css({top:"-128vw",willChange:"auto"}),console.log("droping end"),n.hide(),snowBoomAnimate()):requestAnimationFrame(d)};requestAnimationFrame(d)}function snowBoomAnimate(){var a=$(".block");createjs.Sound.play("boom"),setTimeout(function(){$("#boom").show(),a.show()},100),setTimeout(function(){$("#boom").remove(),$(".ground").on("touchend",".snow",function(){createjs.Sound.play("wipe"),$(this).off("touchend").remove()})},5500)}function furtherStageAnimate(){$("#stage,#moon,#sky").toggleClass("far"),setTimeout(function(){santaClausAnimate3()},2500)}function animate(a,n,t,s,e,o){e=s>t?e:-e,$(a).css("willChange",n);var i=function(){t+=e,$(a).css(n,t.toFixed(2)+"vw"),Math.abs(t-s)<Math.abs(e)?($(a).css(n,s+"vw"),$(a).css("willChange","auto"),o&&o()):requestAnimationFrame(i)};requestAnimationFrame(i)}window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},FastClick.attach(document.body);var cacheImage=["./images/dark.png","./images/moon.png","./images/santa_claus_shadow.gif","./images/santa_claus_shadow_left.gif","./images/santa_claus_normal.gif","./images/santa_claus_gift.gif","./images/santa_claus_done.png","./images/gift.png","./images/bush.png","./images/stage_nothing.png","./images/star_big.png","./images/star_small.png","./images/snow/snow_01.png","./images/snow/snow_02.png","./images/snow/snow_03.png","./images/boom/boom_04.png","./images/block_1.png","./images/block_2.png","./images/block_all.png","./images/block_4.png","./images/start_btn.png","./images/start_logo.png","./images/start_name.png","./images/ticket.png","./images/santa_claus_finish.png"],cacheAudio=[{src:"./sound/gift.mp3",id:"gift"},{src:"./sound/boom.wav",id:"boom"},{src:"./sound/wipe.mp3",id:"wipe"},{src:"./sound/bgm.mp3",id:"bgm"},{src:"./sound/laugh.mp3",id:"laugh"},{src:"./sound/bell.mp3",id:"bell"}],c_image_length=cacheImage.length,c_audio_length=cacheAudio.length,res_total_length=c_image_length+c_audio_length,audioDone=0,belling=null,loadingani=loading();$(function(){preloadImages(cacheImage,function(){preloadAudio(cacheAudio)},res_total_length)});var $santaClaus=$("#santa-claus");