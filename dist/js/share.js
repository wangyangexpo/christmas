function bindOpenGift(t){$(".box").on("click",".normal",function(){var e,n=parseInt($(this).index())+1;openGift(t,n,function(t){var i=t.master_result,o=t.custom_result,a=$.trim(t.nickname),s=t.custom_code||"";setData({custom_nickname:a,custom_result:o,mb_code:s}),e=template("gift_tpl",{giftid:i,gifttext:config.wish[i]}),$(".gift-wrap").html(e),$("#ogmask").show(),e=template("box_tpl",{status:0,data:{position:n,result:i}}),$(".box").html(e).show()})}),$("#ogmask").on("click",".tellhim",function(){$("#tmask").show()}).on("click",".leave",function(){$("#ogmask").hide(),setTimeout(function(){location.href="./mygift_unopen.html"},1e3)}),$("#tmask").on("click",function(){$("#tmask").hide()})}function bindGiftCheck(){var t=$(".getcode"),e=$(".phone"),n=$(".code"),i=/^1[0-9]{10}$/;t.on("click",function(){var n=t.text(),o=$.trim(e.val());11==o.length&&i.test(o)?"获取验证码"==n&&(countDown(60),giftGetCode(o)):alert("请输入正确的手机号")}),$(".check-code").on("click",".commit",function(){var t=$.trim(e.val()),i=$.trim(n.val());console.log(t,i),t?i?giftCheckCode(t,i,function(e){0==e.error_code&&(location.href="./mygift_receive.html?giftid=103&phone="+t)}):alert("请输入验证码！"):alert("请输入手机号！")}),$(".no-check").on("click",".commit",function(){location.href="./mygift_receive.html?giftid=103&phone="+getData("nickname")})}function countDown(t){var e=$(".getcode"),n=setInterval(function(){t?e.text(t-1+"秒"):(e.text("获取验证码"),clearInterval(n)),t--},1e3)}FastClick.attach(document.body),template.helper("dateFormat",function(t){var e="MM/dd hh:mm",n={M:(t=new Date(1e3*t)).getMonth()+1,d:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),q:Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};return e=e.replace(/([yMdhmsqS])+/g,function(e,i){var o=n[i];return void 0!==o?(e.length>1&&(o=(o="0"+o).substr(o.length-2)),o):"y"===i?(t.getFullYear()+"").substr(4-e.length):e})}),template.helper("trim",function(t){return $.trim(t)}),template.helper("giftName",function(t){return config.wish[t]}),$(function(){$(".snow-canvas").snow();var t=getQueryString("master_uid");getAssistList(t,function(e){if(0==e.error_code){var n=$.trim(e.master_info.nickname);setData({nickname:e.master_info.nickname});var i,o=e.master_info.headimgurl;$(".nickname").text("（"+n+"）");var a={status:e.master_prize_status,data:e.master_prize_info};if(0==a.status||103!=a.data.result){var s=window.location.href;wxShare(s,1,n);var c={status:e.custom_prize_status,data:e.custom_prize_info};i=template("box_tpl",c),$(".box").html(i).show(),1==c.status&&bindOpenGift(t)}else $("#santa_claus").addClass("done"),$(".box").addClass("find").show(),$(".content").find(".title").addClass("find"),o?joinGameByWX(function(e){0==e.error_code&&e.id==t&&$(".check-code").show()}):$(".no-check").show(),bindGiftCheck();e.prize_list&&e.prize_list.length>0&&(i=template("assist_tpl",{assistlist:e.prize_list}),$(".assist-wrap").html(i))}})});