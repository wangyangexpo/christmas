function loading(){var a=0,n=$("#loading_pic");return setInterval(function(){a%=6,n.css("backgroundPosition",40*-a+"vw"),a++},100)}function preloadImages(a,n,t){for(var e=a.length,s=0,i=0;i<e;i++){var o=document.createElement("img");o.src=a[i],o.onload=function(){this.onload=null,s++,$("#load_percent").text((s/t*100).toFixed(2)),s>=e&&n()}}}function loadHandler(a){audioDone++,$("#load_percent").text(((c_image_length+audioDone)/res_total_length*100).toFixed(2)),audioDone>=c_audio_length&&(clearInterval(loadingani),$("#loading").remove(),$("#stage,#gotext,#logo,#go").show(),$("#go").on("touchstart",function(){$("#go").off("touchstart"),$(".before").addClass("disappear"),createjs.Sound.play("bgm"),santaClausAnimate2()}))}function preloadAudio(a){createjs.Sound.on("fileload",loadHandler);var n=a.length;if(n)for(var t=0;t<n;t++)createjs.Sound.registerSound(a[t].src,a[t].id);else clearInterval(loadingani),$("#loading").remove(),$("#stage,#gotext,#logo,#go").show(),$("#go").on("touchstart",function(){$("#go").off("touchstart"),$(".before").addClass("disappear"),createjs.Sound.play("bgm"),santaClausAnimate2()})}function santaClausAnimate2(){$santaClaus.addClass("santa-claus-2"),animate("#santa-claus","left",-15,104,.8,function(){$santaClaus.removeClass("santa-claus-2"),furtherStageAnimate()})}function santaClausAnimate3(){$santaClaus.addClass("santa-claus-3"),animate("#santa-claus","left",100,90,1.2,function(){$santaClaus.find(".pop").addClass("show"),animate("#santa-claus","left",90,20,1.2,function(){$santaClaus.find(".pop").removeClass("show"),animate("#santa-claus","left",20,-60,1.2,function(){$santaClaus.removeClass("santa-claus-3"),santaClausAnimate4()})})})}function santaClausAnimate4(){$santaClaus.addClass("santa-claus-4"),animate("#santa-claus","left",-120,20,2,function(){$santaClaus.find(".pop").addClass("show"),createjs.Sound.play("laugh"),setTimeout(function(){$santaClaus.removeClass("santa-claus-4"),$santaClaus.addClass("santa-claus-5"),giftAnimate()},1e3)})}function giftAnimate(){var a=$("#gift");a.show();createjs.Sound.play("gift");var n=13,t=14.9,e=29,s=150,i=Math.abs(n-32),o=Math.abs(.8),g=(34-e)*o/i,m=(110-s)*o/i,l=(36.6-t)*o/i,d=function(){n+=.8,e+=g,s+=m,t+=l,a.css({width:n+"vw",height:t+"vw",top:s+"vw",left:e+"vw"}),Math.abs(32-n)<Math.abs(.8)?(a.css({width:"32vw",height:"36.6vw",top:"110vw",left:"34vw"}),console.log("gift end"),giftDroping()):requestAnimationFrame(d)};requestAnimationFrame(d)}function giftDroping(){var a=$("#stage"),n=$("#gift"),t=0,e=110,s=34,i=32,o=36.6,g=Math.abs(t- -128),m=Math.abs(-3),l=(290-e)*m/g,d=(48-i)*m/g,u=(26-s)*m/g,c=(54.9-o)*m/g,r=function(){t+=-3,e+=l,i+=d,s+=u,o+=c,n.css({top:e+"vw",width:i+"vw",height:o+"vw",left:s+"vw"}),a.css({top:t+"vw"}),Math.abs(-128-t)<Math.abs(-3)?(n.css({top:"290vw",width:"48vw",height:"54.9vw",left:"26vw"}),a.css({top:"-128vw"}),console.log("droping end"),n.hide(),snowBoomAnimate()):requestAnimationFrame(r)};requestAnimationFrame(r)}function snowBoomAnimate(){var a=$(".block"),n=$(".ground"),t=$("#model");setTimeout(function(){var e=$(".boom"),s=$(".snow-mask"),i=$(".res-window");s.show(),e.show().one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){console.log("ani end"),e.remove(),s.remove(),$(".hand-1").addClass("gesture"),n.on("touchend",".snow",function(){createjs.Sound.play("wipe"),$(this).off("touchend").addClass("disappear"),3==$(".snow.disappear").length&&($(".hand-1").remove(),createjs.Sound.play("wind"),ticketAnimateIn(),setTimeout(function(){ticketAnimateOut()},3e3))}).on("touchend",".touch",function(){n.off("touchend"),a.addClass("disappear"),t.addClass("appear"),i.addClass("appear"),$(".snow.disappear").remove(),$(".hand-2").remove(),t.css("zIndex",999),i.on("touchend",".btn",function(){location.href="./html/findlast.html"})})}),a.show()},100)}function furtherStageAnimate(){$("#stage,#moon,#sky").toggleClass("far"),setTimeout(function(){santaClausAnimate3()},2500)}function animate(a,n,t,e,s,i){s=e>t?s:-s;var o=function(){t+=s,$(a).css(n,t.toFixed(2)+"vw"),Math.abs(t-e)<Math.abs(s)?($(a).css(n,e+"vw"),i&&i()):requestAnimationFrame(o)};requestAnimationFrame(o)}function ticketAnimateIn(){$("#ticket").addClass("zoomInRight animated").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("zoomInRight")})}function ticketAnimateOut(){console.log("out"),$("#ticket").addClass("zoomOutLeft").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("zoomOutLeft animated"),$(".hand-2").show()})}if(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,!window.requestAnimationFrame){var lastTime=0;window.requestAnimationFrame=function(a,n){var t=(new Date).getTime(),e=Math.max(0,16.7-(t-lastTime)),s=window.setTimeout(function(){a(t+e)},e);return lastTime=t+e,s},window.cancelAnimationFrame=function(a){clearTimeout(a)}}FastClick.attach(document.body);var cacheImage=["./images/dark.png","./images/moon.png","./images/santa_claus_shadow.gif","./images/santa_claus_shadow_left.gif","./images/santa_claus_normal.gif","./images/santa_claus_gift.gif","./images/santa_claus_done.png","./images/santa_claus_finish.png","./images/gift.png","./images/bush.png","./images/stage_nothing.jpeg","./images/star_big.png","./images/star_small.png","./images/snow/snow_01.png","./images/snow/snow_02.png","./images/snow/snow_03.png","./images/boom/boom_04.png","./images/block_1.png","./images/block_2.png","./images/block_all.png","./images/block_4.png","./images/btn/start_btn.png","./images/start_logo.png","./images/start_name.png","./images/ticket.png","./images/gesture/gesture.png","./images/gesture/gesture.gif","./images/pop_1.png","./images/pop_2.png","./images/findlast/window.png","./images/findlast/fenxiang_bg.png","./images/btn/btn_next.png","./images/opened/bg_light.png","./images/opened/card_bg.png","./images/opened/jingche.png","./images/opened/nianka.png","./images/opened/yueka.png","./images/share/bg_xmas.png","./images/snow/santa_claus_no_hat.png","./images/snow/santa_claus_with_hat.png","./images/unopen/pic_liwu.png","./images/unopen/santa.png","./images/share/dialog_pic_jimu.png","./images/share/dialog_pic_note.png"],cacheAudio=[{src:"./sound/gift.mp3",id:"gift"},{src:"./sound/wipe.mp3",id:"wipe"},{src:"./sound/bgm.mp3",id:"bgm"},{src:"./sound/laugh.mp3",id:"laugh"},{src:"./sound/wind.mp3",id:"wind"}],c_image_length=cacheImage.length,c_audio_length=cacheAudio.length,res_total_length=c_image_length+c_audio_length,audioDone=0,loadingani=loading();$(function(){is_weixin()||is_mobike()?preloadImages(cacheImage,function(){preloadAudio(cacheAudio)},res_total_length):location.replace("./html/notfound.html")});var $santaClaus=$("#santa-claus");