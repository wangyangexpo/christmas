function bindOpenGift(t){$(".box").on("click",".normal",function(){var e,i=parseInt($(this).index())+1;openGift(t,i,function(t){var n=t.master_result,o=t.custom_result,a=$.trim(t.nickname),c=t.custom_code||"";setData({custom_nickname:a,custom_result:o,mb_code:c}),e=template("gift_tpl",{giftid:n,gifttext:config.wish[n]}),$(".gift-wrap").html(e),$("#ogmask").show(),e=template("box_tpl",{status:0,data:{position:i,result:n}}),$(".box").html(e).show()})}),$("#ogmask").on("click",".tellhim",function(){$("#tmask").show()}).on("click",".leave",function(){$("#ogmask").hide(),setTimeout(function(){location.href="./mygift_unopen.html"},1e3)}),$("#tmask").on("click",function(){$("#tmask").hide()})}function bindGiftCheck(){var t=$(".getcode"),e=$(".phone"),i=$(".code"),n=/^1[0-9]{10}$/;t.on("click",function(){var i=t.text(),o=$.trim(e.val());11==o.length&&n.test(o)?"获取验证码"==i&&(countDown(60),giftGetCode(o)):alert("请输入正确的手机号")}),$(".check-code").on("click",".commit",function(){var t=$.trim(e.val()),n=$.trim(i.val());console.log(t,n),t?n?giftCheckCode(t,n,function(e){0==e.error_code&&(location.href="./mygift_receive.html?giftid=103&phone="+t)}):alert("请输入验证码！"):alert("请输入手机号！")}),$(".no-check").on("click",".commit",function(){location.href="./mygift_receive.html?giftid=103&phone="+getData("nickname")})}function countDown(t){var e=$(".getcode"),i=setInterval(function(){t?e.text(t-1+"秒"):(e.text("获取验证码"),clearInterval(i)),t--},1e3)}FastClick.attach(document.body),template.helper("dateFormat",function(t){var e="MM/dd hh:mm",i={M:(t=new Date(1e3*t)).getMonth()+1,d:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),q:Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};return e=e.replace(/([yMdhmsqS])+/g,function(e,n){var o=i[n];return void 0!==o?(e.length>1&&(o=(o="0"+o).substr(o.length-2)),o):"y"===n?(t.getFullYear()+"").substr(4-e.length):e})}),template.helper("trim",function(t){return $.trim(t)}),template.helper("giftName",function(t){return config.wish[t]}),$(function(){var t=getQueryString("master_uid");$(".trigger").on("click",function(){$(".desc").toggleClass("close")}),getAssistList(t,function(e){if(0==e.error_code){var i,n=$.trim(e.master_info.nickname),o=e.master_info.headimgurl;$(".nickname").text("（"+n+"）");var a={status:e.master_prize_status,data:e.master_prize_info};if(0==a.status||103!=a.data.result){var c=window.location.href;wxShare(c,1,n);var s={status:e.custom_prize_status,data:e.custom_prize_info};i=template("box_tpl",s),$(".box").html(i).show(),1==s.status&&bindOpenGift(t)}else ptgame.gotoHatDown(),$(".box").addClass("find").show(),$(".content").find(".title").addClass("find"),o?joinGameByWX(function(e){0==e.error_code&&e.id==t&&$(".check-code").show()}):$(".no-check").show(),bindGiftCheck();e.prize_list&&e.prize_list.length>0&&(i=template("assist_tpl",{assistlist:e.prize_list}),$(".assist-wrap").html(i))}})});