function loading(){var a=0,n=$("#loading_pic");return setInterval(function(){a%=6,n.css("backgroundPosition",40*-a+"vw"),a++},100)}function preloadImages(a,n,e){for(var t=a.length,i=0,s=0;s<t;s++){var o=document.createElement("img");o.src=a[s],o.onload=function(){this.onload=null,i++,$("#load_percent").text((i/e*100).toFixed(2)),i>=t&&n()}}}function loadHandler(a){audioDone++,$("#load_percent").text(((c_image_length+audioDone)/res_total_length*100).toFixed(2)),audioDone>=c_audio_length&&(clearInterval(loadingani),$("#loading").remove(),$("#stage,.before").show(),$("#go").on("touchstart",function(){$("#go").off("touchstart"),$(".before").addClass("disappear"),createjs.Sound.play("bgm"),santaClausAnimate2()}))}function preloadAudio(a){createjs.Sound.on("fileload",loadHandler);var n=a.length;if(n)for(var e=0;e<n;e++)createjs.Sound.registerSound(a[e].src,a[e].id);else clearInterval(loadingani),$("#loading").remove(),$("#stage,.before").show(),$("#go").on("touchstart",function(){$("#go").off("touchstart"),$(".before").addClass("disappear"),createjs.Sound.play("bgm"),santaClausAnimate2()})}function santaClausAnimate2(){$santaClaus.addClass("santa-claus-2"),animate("#santa-claus","left",-15,104,.8,function(){$santaClaus.removeClass("santa-claus-2"),furtherStageAnimate()})}function santaClausAnimate3(){$(".before").remove(),$santaClaus.addClass("santa-claus-3"),animate("#santa-claus","left",100,90,1.2,function(){$santaClaus.find(".pop").addClass("show"),animate("#santa-claus","left",90,20,1.2,function(){$santaClaus.find(".pop").removeClass("show"),animate("#santa-claus","left",20,-60,1.2,function(){$santaClaus.removeClass("santa-claus-3"),santaClausAnimate4()})})})}function santaClausAnimate4(){$santaClaus.addClass("santa-claus-4"),animate("#santa-claus","left",-120,20,2,function(){$santaClaus.find(".pop").addClass("show"),createjs.Sound.play("laugh"),setTimeout(function(){$santaClaus.removeClass("santa-claus-4"),$santaClaus.addClass("santa-claus-5"),giftAnimate()},1e3)})}function giftAnimate(){var a=$("#gift");a.show();createjs.Sound.play("gift");var n=13,e=14.9,t=29,i=150,s=Math.abs(n-32),o=Math.abs(.8),m=(34-t)*o/s,g=(110-i)*o/s,d=(36.6-e)*o/s,l=function(){n+=.8,t+=m,i+=g,e+=d,a.css({width:n+"vw",height:e+"vw",top:i+"vw",left:t+"vw"}),Math.abs(32-n)<Math.abs(.8)?(a.css({width:"32vw",height:"36.6vw",top:"110vw",left:"34vw"}),console.log("gift end"),giftDroping()):requestAnimationFrame(l)};requestAnimationFrame(l)}function giftDroping(){var a=$("#stage"),n=$("#gift"),e=$("#sky,#moon"),t=0,i=110,s=34,o=32,m=36.6,g=Math.abs(t- -128),d=Math.abs(-3),l=(290-i)*d/g,u=(48-o)*d/g,c=(26-s)*d/g,r=(54.9-m)*d/g,p=function(){t+=-3,i+=l,o+=u,s+=c,m+=r,n.css({top:i+"vw",width:o+"vw",height:m+"vw",left:s+"vw"}),a.css({top:t+"vw"}),Math.abs(-128-t)<Math.abs(-3)?(n.css({top:"290vw",width:"48vw",height:"54.9vw",left:"26vw"}),a.css({top:"-128vw"}),console.log("droping end"),n.remove(),e.remove(),snowBoomAnimate()):requestAnimationFrame(p)};requestAnimationFrame(p)}function snowBoomAnimate(){var a=$(".block"),n=$(".ground"),e=$("#model");setTimeout(function(){var t=$(".boom"),i=$(".snow-mask"),s=$(".res-window");i.show(),t.show().one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){console.log("ani end"),t.remove(),i.remove(),$(".hand-1").addClass("gesture"),$(".tip-1").addClass("show"),n.on("touchend",".snow",function(){createjs.Sound.play("wipe"),$(this).off("touchend").addClass("disappear"),3==$(".snow.disappear").length&&($(".hand-1").remove(),$(".tip-1").remove(),createjs.Sound.play("wind"),ticketAnimateIn(),setTimeout(function(){ticketAnimateOut()},3e3))}).on("touchend",".touch",function(){n.off("touchend"),a.addClass("disappear"),e.css("zIndex",999).addClass("appear"),alertAnimate(s,"fadeInLeft"),$(".hand-2").remove(),$(".tip-2").remove(),s.on("touchend",".btn",function(){location.href="./html/findlast.html"})})}),a.show()},100)}function furtherStageAnimate(){$("#stage,#moon,#sky").toggleClass("far"),setTimeout(function(){santaClausAnimate3()},2500)}function animate(a,n,e,t,i,s){i=t>e?i:-i;var o=function(){e+=i,$(a).css(n,e.toFixed(2)+"vw"),Math.abs(e-t)<Math.abs(i)?($(a).css(n,t+"vw"),s&&s()):requestAnimationFrame(o)};requestAnimationFrame(o)}function alertAnimate(a,n){a.css("zIndex",999).addClass(n+" animated").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass(n)})}function ticketAnimateIn(){$("#ticket").addClass("zoomInRight animated").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("zoomInRight"),$(".snow").remove()})}function ticketAnimateOut(){console.log("out"),$("#ticket").addClass("zoomOutLeft").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("zoomOutLeft animated").remove(),$(".hand-2").show(),$(".tip-2").addClass("show")})}if(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,!window.requestAnimationFrame){var lastTime=0;window.requestAnimationFrame=function(a,n){var e=(new Date).getTime(),t=Math.max(0,16.7-(e-lastTime)),i=window.setTimeout(function(){a(e+t)},t);return lastTime=e+t,i},window.cancelAnimationFrame=function(a){clearTimeout(a)}}FastClick.attach(document.body);var cacheImage=["./images/icon_help.png","./images/dark.png","./images/moon.png","./images/santa_claus_shadow.gif","./images/santa_claus_shadow_left.gif","./images/santa_claus_normal.gif","./images/santa_claus_gift.gif","./images/santa_claus_done.png","./images/santa_claus_finish.png","./images/gift.png","./images/bush.png","./images/stage_nothing.jpeg","./images/star_big.png","./images/star_small.png","./images/snow/snow_01.png","./images/snow/snow_02.png","./images/snow/snow_03.png","./images/boom/boom_04.png","./images/block_1.png","./images/block_2.png","./images/block_all.png","./images/block_4.png","./images/btn/start_btn.png","./images/start_logo.png","./images/start_name.png","./images/ticket.png","./images/gesture/gesture.png","./images/gesture/gesture.gif","./images/pop_1.png","./images/pop_2.png","./images/findlast/window.png","./images/findlast/fenxiang_bg.png","./images/btn/btn_next.png","./images/opened/bg_light.png","./images/opened/card_bg.png","./images/opened/jingche.png","./images/opened/nianka.png","./images/opened/yueka.png","./images/share/bg_xmas.png","./images/snow/santa_claus_no_hat.png","./images/snow/santa_claus_with_hat.png","./images/unopen/pic_liwu.png","./images/unopen/santa.png","./images/share/dialog_pic_jimu.png","./images/share/dialog_pic_note.png"],cacheAudio=[{src:"./sound/gift.mp3",id:"gift"},{src:"./sound/wipe.mp3",id:"wipe"},{src:"./sound/bgm.mp3",id:"bgm"},{src:"./sound/laugh.mp3",id:"laugh"},{src:"./sound/wind.mp3",id:"wind"}],c_image_length=cacheImage.length,c_audio_length=cacheAudio.length,res_total_length=c_image_length+c_audio_length,audioDone=0,loadingani=loading();$(function(){is_weixin()||is_mobike()?preloadImages(cacheImage,function(){preloadAudio(cacheAudio)},res_total_length):location.replace("./html/notfound.html")});var $santaClaus=$("#santa-claus");